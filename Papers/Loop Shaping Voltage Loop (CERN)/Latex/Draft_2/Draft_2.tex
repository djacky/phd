\documentclass[a4paper, 10pt, conference]{ieeeconf}  
%\documentclass[letterpaper, 10 pt, conference]{ieeeconf}  % Use this for US paper
\IEEEoverridecommandlockouts
\overrideIEEEmargins
\bibliographystyle{IEEEtran}
%\usepackage{natbib}

\usepackage{graphicx}  % Add graphics capabilities
\usepackage{color}
\usepackage{amsmath} % assumes amsmath package installed
\usepackage{amssymb}  % assumes amsmath package installed
\usepackage{mathrsfs}

\let\proof\relax
\let\endproof\relax
\usepackage{amsthm}

\usepackage{epstopdf}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem*{remark}{Remark}
\newtheorem{definition}{Definition}


\newcommand{\jo}{(j\omega)}
\newcommand{\jok}{(e^{-j\omega_k})}
\newcommand{\jro}{(e^{-j\omega},\rho)}
\newcommand{\jrok}{(e^{-j\omega_k},\rho)}



\title{A Data-Driven Approach to Power Converter Control via Convex Optimization} 
% Title, preferably not more than 10 words.


\author{Achille Nicoletti$^{1,2}$ and Michele Martino$^{1}$ and Alireza Karimi$^{2}$% <-this % stops a space
\thanks{*This work was not supported by any organization}% <-this % stops a space
\thanks{$^{1}$Achille Nicoletti and Michele Martino are both with the European Organization for Nuclear Research (CERN), 
 CH-1211 Geneva 23, Switzerland
        {\tt\small  e-mail: achille.nicoletti@cern.ch / michele.martino@cern.ch}}%
\thanks{$^{2}$Alireza Karimi is with Ecole Polytechnique F\'{e}d\'{e}rale de Lausanne (EPFL), Institute of Mechanical Engineering (IGM),
   CH-1015 Lausanne, Switzerland
        {\tt\small e-mail: alireza.karimi@epfl.ch}}%
}

%\thanks[footnoteinfo]{Sponsor and financial support acknowledgment
%goes here. Paper titles should be written in uppercase and lowercase
%letters, not all uppercase.}

%\author[First]{Achille Nicoletti} 
%\author[First]{Michele Martino} 
%\author[Second]{Alireza Karimi}

%\address[First]{The European Organization for Nuclear Research (CERN), 
  % CH-1211 Geneva 23, Switzerland (e-mail: achille.nicoletti@cern.ch / michele.martino@cern.ch)}
%\address[Second]{Ecole Polytechnique F\'{e}d\'{e}rale de Lausanne (EPFL), 
   %CH-1015 Lausanne, Switzerland (e-mail: alireza.karimi@epfl.ch)}


\begin{document}

\maketitle
\thispagestyle{empty}
\pagestyle{empty}

\begin{abstract}                % Abstract of not more than 250 words.
A new model reference data-driven approach is presented for synthesizing controllers for the CERN power converter control system. This method uses the frequency response function (FRF) of a system in order to avoid the problem of unmodeled dynamics associated with low-order parametric models. For this particular application, it is shown that a convex optimization problem can be formulated (in either the $H_\infty$ or $H_2$ sense) to shape the closed-loop FRF while guaranteeing the closed-loop stability. This optimization problem is realized by linearizing a non-convex constraint around a stabilizing operating point. The effectiveness of the method is illustrated by designing a controller for the SATURN power converter which is used in the Large Hadron Collider, in injector machines, and for pulsed applications at CERN. Experimental validation in the frequency-domain is also presented. 
\end{abstract}


%===============================================================================
\section{Introduction}
Today's industrial processes pose challenging problems to control engineers due to the increasing complexities of system structures. In order to simplify the controller design process, these systems are approximated with low-order parameteric models; this reduces both time and effort in synthesizing a controller. However, this approximation can create stability and performance problems since these low-order models are subject to model uncertainty. Data-driven control methods seek to alleviate this problem by synthesizing controllers based on time-domain or frequency-domain data (i.e., synthesis is model independant). A survey on the differences associated with model-based control and data-driven control has been addressed in \cite{HW13} and \cite{FK13a}; the authors assert that model-based control methods are inherently less robust due to the unmodeled dynamics of a process, and that these controllers are unsafe for practical applications. In other words, the parametric uncertainties and the unmodeled dynamics associated with the data-driven scheme are irrelevant, and the only source of uncertainty is the measurement error. 

%Data-driven controllers can be synthesized either on-line or off-line; the on-line methods such as the classical direct adaptive control (MRAC) \cite{LLMK11}, model-free adaptive control (MFAC) \cite{HJ13}, and the unfalsified control (UC) \cite{ST97} methodologies design controllers using time-domain data. Iterative feedback tuning (IFT) \cite{Hja02}, correlation-based tuning (CBT) \cite{KMB02a}, virtual reference feedback tuning (VRFT) \cite{CLS02}, non-iterative data-driven model reference control \cite{KVB07} methodologies are all off-line time-domain data-driven methods.  The widely used PID controller are usually tuned based on a set of time-domain or frequency-domain data. 

Frequency-domain based controller synthesis methods are design schemes that continue to spark the interest of many researchers. The authors in \cite{KNND13b} establish a robust frequency-domain controller design method that requires a solution to a non-linear optimization problem. A frequency-domain loop-shaping method for fixed-structure controllers is proposed in \cite{KNND13c}; however, stability is not guaranteed with this method and must be verified a posteriori. Controller synthesis methods belonging to the $\mathcal{H}_{\infty}$ control framework minimizes the $\mathcal{H}_{\infty}$ norm of a weighted closed-loop sensitivity function. A convex optimization approach is used to design linearly-parameterized (LP) controllers with loop-shaping and $\mathcal{H}_{\infty}$ performance in \cite{KG10}. The constraints are convexified around a desired open-loop transfer function. A frequency-domain approach for computing low-order multivariable LP controllers is presented in \cite{SOW10}. The $\mathcal{H}_{\infty}$ constraints are convexified around an initial stabilizing controller. An iterative algorithm is used that converges to a local optimal solution of the non-convex problem. Moreover, in \cite{HAB13},  a convex-concave approximation of the $\mathcal{H}_{\infty}$ constraint is used which leads to the same constraints as \cite{KG10} for PID controllers. This method is then generalized to MIMO PID controller design in \cite{BHA16} for stable systems. More recent works that implement an iterative loop-shaping method that ensures $\mathcal{H}_{\infty}$ performance have been devised in \cite{KK16}. This method is not limited to LP controllers and stable systems and can consider $H_2$ performance as well. Recently, the necessary and sufficient conditions for the existence of $\mathcal{H}_{\infty}$ controllers for SISO systems represented by their frequency response has been proposed in \cite{KNZ16}. The advantage of this method is that it does not require an initial stabilizing controller and converges to the global optimal solution if the controller order goes to infinity.

The method proposed in this paper is an extension of \cite{KK16} to the model reference control problem and invokes a new data-driven control design scheme for specific power converter applications at CERN. Currently, the load (i.e., the magnet of the particle accelerator) is often approximated as a simple first-order system (series $RL$ circuit) even though it has been shown in \cite{Shafer1}, \cite{Shafer2} and \cite{Ravaioli1} that both real and imaginary part of its impedance are ferquency dependent and its behavior is also affected by the vacuum chamber of the magnet. Therefore, it is appropriate to consider a data-driven based design to regulate the power converter control system.  In this work, it is shown that a model reference design in the $\mathcal{H}_\infty$ or $\mathcal{H}_2$ sense can be formulated through a convex optimization problem; however, the methods described in this paper can also be applied to mixed $\mathcal{H}_2$ and $\mathcal{H}_\infty$ problems (i.e., minimizing the norm of weighted sensitivity functions). Additionally, with certain trivial conditions on the controller parameters, it is shown that the closed-loop stability is guaranteed. 

The paper is organized as follows. The class of models represented by FRF's are addressed in Section \ref{sec:prelim}. Section \ref{sec:system} discusses the framework of the power converter control system and its functionality at CERN. The main results and theoretical bases are addressed in Section \ref{sec:main}; in this section, loop-shaping constraints are formulated for the power converter control system. Section \ref{sec:case} is dedicated to a case study where the effectiveness of the method is demonstrated by applying the proposed design scheme to a power converter control system for a specific accelerator requirement. Finally, the concluding remarks are given in section \ref{sec:conclusion}.

\section{Preliminaries}
\label{sec:prelim}
The class of systems discussed in this paper will be Linear Time-Invariant Single-Input Single-Output (LTI-SISO) systems that will be represented by a FRF $G\jo$.  The FRF can be obtained directly with a given transfer function (TF) model, or through an identification experiment using the Fourier analysis method. Let $U\jo$ and $Y\jo$ represent the FRFs of the system input and output signals, respectively. Then the FRF of the system can be represented as 
\begin{equation}
G\jo = Y\jo U^{-1}\jo
\end{equation}
In general, a set $\mathcal{G}$ can be formulated to represent a plant model containing $p$ FRF models:
\begin{equation}
\mathcal{G} = \{G_l\jo; \quad l=1,\ldots,p; \quad \forall \omega \in \Omega\}
\end{equation} 
$\Omega \in [0,\infty)$. For simplicity, one model from the set $\mathcal{G}$ will be considered, and the subscript $l$ will be omitted. However, in general, the design procedures outlined in this paper can be applied to the multi-model case (as will be seen in the case study). 

Additionally, for notation purposes, let us define $\mathscr{S}$ as the set of all strictly proper (stable) TF's and $\mathscr{P}$ as the set of all proper (stable) TF's. 

\begin{remark}
In this work, the control structure will contain both discrete-time and continuous time systems. However, the proposed method synthesizes controllers based on the FRF of the system (i.e., the design method is not based on the parametric model); therefore, if the Nyquist-Shannon sampling rate is met, then the FRF of discrete-time systems will be nearly identical to that of the continuous-time system.
\end{remark}

\section{System Framework}
\label{sec:system}
\begin{figure*}
\centering
\includegraphics[width=1.7\columnwidth]{../pics/voltage_loop_schematic_color_coded}
\caption{Power converter control system schematic. The magnet represents the load of the process while the DSP implements the control strategy. The blue portion represents the power electronics of the converter; the yellow portion represents the analog process of the converter with the load; the red portion represents the digital-signal processor (DSP) which implements the control strategy; and the green block represents the measurement board which reads the desired control variables and sends the information to the DSP for processing.}
\label{fig:circuit}
\end{figure*}
A schematic of the power converter with its control system is shown in Fig.~\ref{fig:circuit}. Specific portions of the schematic are color-coded in order to construct the associated block diagram. Note that there are two power converter branches assembled in series in this schematic; however, both branches possess the same components with identical values. Therefore, the analysis and control strategy can be performed in one branch and then scale the controller parameters accordingly (i.e., by a factor of 2). The input voltage for one of the high frequency (HF) filters will be denoted as $v_i$ while the output voltage of the filter (for one branch) will be denoted as $v_0$. The TF from $v_i$ to $v_0$ describes the output filter of the power converter for one branch; the HF filter is needed to remove the high frequency components of the PWM voltage at the output of the SMPS power stage (SMPS Switched Mode Power Supply). For general applications at CERN, the objective is to control the current in the magnet such that the error between this output current and a delayed version of the reference current is minimized. However, the objective of this paper is to design and implement a controller to shape the FRF between the reference voltage and $v_0$. This intermediate control is performed due to the fact that the HF filter typically possesses large resonances, and a controller is required to attenuate these resonances in order to ensure better performance in the current loop. Large resonances are present because the values of the filter resistances are kept small in order to reduce the power losses. Large resistance values can attenuate the resonances at the price of larger power losses and would therefore compromise energy efficiency. Another reason for implementing this type of control structure at CERN is for commissioning purposes; if/when faults occur in the system, each loop can be verified one at a time to ensure quality operation.

The block diagram of the control strategy is shown in Fig.~\ref{fig:damping_loop}. This block diagram is color-coded to correlate with the structure of the schematic in Fig.~\ref{fig:circuit}. The analog-to-digital converter (ADC) is used to process the information from the analog system to the DSP; $G_0(s)$ represents the TF from $v_i$ to $v_0$; $H(s)$ represents the TF from $v_0$ to $i_c$ (the current through the capacitor in the HF filter); $P_1(s)$ and $P_2(s)$ are sensors (i.e., low-pass filters); $k_i$ and $k_u$ are the control variable gains; $\tau \: [s]$ is an actuation delay that is used to approximate the dynamics of the power electronics; and $C(z^{-1})$ is a PI controller, i.e., $$C(z^{-1}) = k_{p_1} + k_{p_2}\frac{t_s z^{-1}}{1-z^{-1}}$$ where $t_s \: [s]$ is the sampling rate of the DSP. The ADCs have very fast dynamics relative to the other subsystems in the loop; for this reason, it is appropriate to consider the ADCs as pure time delays (which will be denoted with a delay $\tau_{a} \: [s]$). The transfer function analyzer (TFA) is used for identification purposes, and will be discussed in the case study. As stated in the Remark in the previous section, the FRFs of continuous-time and discrete-time systems are nearly identical when the Nyquist-Shannon sampling theorem is met. Since the proposed method invokes a data-driven method using the FRF of a system, all functions discussed hereafter will be FRFs.

From this framework, it can be observed that the inner feedback loops are reminiscent of a state-feedback control architecture. For this application, note that $\{G_0,P_1,P_2 \} \in \mathscr{S}$ and $H \in \mathscr{P}$ (where $H$ possesses a zero at zero). The objective of this application is to design controller's gains such that the FRFs from $v_d$ to $v_0$ and $v_r$ to $v_0$ both achieve the desired reference models.
\begin{figure*}
\centering
\includegraphics[width=1.6\columnwidth]{../pics/voltage_loop_color_coded}
\caption{Interconnection of the power converter control system. During normal operation, the TFA along with the connections indicated with a dashed-black line are not present.}
\label{fig:damping_loop}
\end{figure*}

In order to simplify the system framework, let us define the following quantities:
\begin{equation} \label{eq:new_var}
\begin{aligned}
k_{m_1} &:= k_{p_1}(1+k_u) ;  &k_{m_2} &:= k_{p_2}(1+k_u)  \\
H_1(k) &:= k_iP_1H;  &H_2(k) &:= k_uP_2e^{-j\omega \tau_{a}} \\
H_3(k) &:=  P_2C_m(k)e^{-j\omega\tau_{a}}; &G &:= G_0e^{-j\omega\tau} \\ 
\end{aligned}
\end{equation}
\begin{equation*}
C_m(k) := k_{m_1}+k_{m_2}\frac{t_se^{-j\omega t_{s}}}{1-e^{-j\omega t_{s}}}
\end{equation*}
where $k = [k_i,k_u,k_{m_1},k_{m_2}]$. Let the FRF from $v_d$ to $v_0$ be denoted as $T^{\prime}(k)$ and the FRF from $v_r$ to $v_0$ be denoted as $T(k)$. These closed-loop FRFs can easily be derived as follows:

\begin{align}
T^{\prime}(k) &= \frac{G(1+k_u)}{1+G[H_1(k)+H_2(k)]} \label{eq:Tclp}  \\ 
T(k) &= \frac{G[1+k_u+C_m(k)]}{1+G[H_1(k)+H_2(k)+H_3(k)]}  \label{eq:Tcl} 
\end{align}

For the remaining theoretical portions of this document, the model reference control will only be shown for $T(k)$, since the same procedures can also be applied to $T^{\prime}(k)$. 

\section{Main Results}
\label{sec:main}
In this section, it will be demonstrated that the performance specification of the control problem will be achieved by formulating a convex optimization problem. The controllers will be synthesized by only considering the FRF of the system.

\subsection{Convex Approximation}
In subsequent sections, it will be shown that the type of optimization problem that will be considered will have the following form:

\begin{equation} \label{eq:con_cav}
\begin{aligned}
& \underset{ k }{\text{minimize}}
& & \gamma  \\
& \text{subject to:} & & y^{\star}(k) \gamma^{-1} y(k) - z^{\star}(k)z(k) < 0 
\end{aligned}
\end{equation}
where $y(k)$ and $z(k)$ are linear functions of the decision variable $k$ and $(\cdot)^{\star}$ denotes the complex conjugate of the argument. This type of problem is convex-concave (due to the $-z^{\star}(k)z(k)$ term). To convexify this constraint, the term $z^{\star}(k)z(k)$ can be linearized around an operating point $k_0$; without loss of generality, it can be shown that the linearization of $z^{\star}(k)z(k)$ leads to the following constraint:

\begin{equation} \label{eq:lin_inequality}
z^{\star}(k)z(k) \geq z^{\star}(k)z_0 + z(k)z_0^{\star} - z_0^{\star}z_0
\end{equation} 
where $z_0 = z(k_0)$. The condition in (\ref{eq:lin_inequality}) can easily be established by realizing the following inequality:

\begin{equation}
[z(k)-z_0]^{\star}[z(k)-z_0] \geq 0
\end{equation}
With this linearization, a sufficient condition for the inequality in (\ref{eq:con_cav}) can be developed as follows:

\begin{equation}
y^{\star}(k) \gamma^{-1} y(k) - [z^{\star}(k)z_0 + z(k)z_0^{\star} - z_0^{\star}z_0]< 0 
\end{equation}
By using the Shur Complement Lemma \cite{BEN09}, the above condition can be expressed in terms of a Linear-Matrix-Inequality (LMI):

\begin{equation} \label{eq:LMI_1}
\begin{bmatrix}
z^{\star}(k)z_0 + z(k)z_0^{\star} - z_0^{\star}z_0 & \phantom{kk} y^{\star}(k) \\
y(k) & \phantom{kk} \gamma
\end{bmatrix}
\succ 0
\end{equation}
This type of formulation will be used in the next section in order to construct a model reference control objective. 

\subsection{Control Performance}  \label{sec:controlperformance}
For SISO systems, and for a stable system $X(s)$, the $\mathcal{H}_2$ and $\mathcal{H}_\infty$ norms are defined as follows:
\begin{align*}
\| X\|_2^2 & := \frac{1}{2\pi} \int_{- \infty}^\infty |X(j\omega)|^2 d\omega \\
\| X\|_\infty & :=  \sup_{\omega} |X(j\omega)|
\end{align*}
It is imperative to note that the boundedness of spectral norm $X$ does not guarantee the stability of $X$. 

A model reference criterion can be considered as a form of control performance. If $T$ is the closed-loop FRF and $T_d$ is the desired FRF, then one can consider minimizing $(T-T_d)$ in either the $\mathcal{H}_2$ or $\mathcal{H}_\infty$ sense in order to shape $T$. 

In the $\mathcal{H}_\infty$ sense, the objective is to minimize $ \|T(k) - T_d \|_\infty$; an equivalent representation of this objective is to minimize $\gamma$ such that $ \|T(k) - T_d \|_\infty < \gamma$. This criterion is satisfied if the following optimization problem is considered:
 
 \begin{equation} \label{eq:min_loopshape}
\begin{aligned}
& \underset{ k \in \mathbb{R}}{\text{minimize}}
& & \gamma  \\
& \text{subject to:} & & \bigl[T(k)-T_d\bigr]^{\star}\bigl[T(k)-T_d\bigr] < \gamma
\end{aligned}
\end{equation}
for all $\omega \in \Omega$. It can be observed that the constraint in (\ref{eq:min_loopshape}) is not convex. Let us now define the following quantities:
\begin{equation} 
\begin{aligned}
w(k) &= G[1+k_u+C_m(k)] \\
z(k) &= 1+G[H_1(k)+H_2(k)+H_3(k)]
\end{aligned}
\end{equation}
where it is evident that $T(k) = w(k)z^{-1}(k)$; then the constraint in (\ref{eq:min_loopshape}) can be written as:
$$
\bigl[w(k)-z(k)T_d \bigr]^{\star}\gamma^{-1} \bigl[w(k)-z(k)T_d \bigr] - z^{\star}(k)z(k)<0
$$

Note that this constraint has the exact form as in (\ref{eq:con_cav}); therefore, the convex constraint in (\ref{eq:LMI_1}) can be utilized to construct the model-reference optimization problem as follows:
\begin{equation} \label{eq:loop_shape_LMI_inf}
\begin{aligned}
& \underset{ k \in \mathbb{R}}{\text{minimize}} \hspace{0.5cm} \gamma  \\
& \text{subject to:} \\
&
\begin{bmatrix}
z^{\star}(k)z_0 + z_0^{\star}z(k) - z_0^{\star}z_0 & \phantom{xx}[w(k)-z(k)T_d]^{\star} \\ 
w(k)-z(k)T_d & \phantom{xx}\gamma
\end{bmatrix} \succ 0
\end{aligned}
\end{equation}
for all $\omega \in \Omega$, where $$z_0 = 1+G[H_1(k_0) + H_2(k_0)+H_3(k_0)]$$ and $k_0 =[k_{i,0},k_{u,0},k_{m_1,0},k_{m_2,0}  ]$ are the initializing gains. 

In a similar manner, the following convex optimization problem can be considered for minimizing  $ \|T(k)- T_d \|_2^2$, as follows:
\begin{equation} \label{eq:loop_shape_LMI_2}
\begin{aligned}
& \underset{ k \in \mathbb{R}}{\text{minimize}} \hspace{0.5cm} \int_0^\infty \gamma(\omega) d\omega  \\
& \text{subject to:} \\
&
\begin{bmatrix}
z^{\star}(k)z_0 + z_0^{\star}z(k) - z_0^{\star}z_0 & \phantom{xx}[w(k)-z(k)T_d]^{\star} \\ 
w(k)-z(k)T_d & \phantom{xx}\gamma(\omega)
\end{bmatrix} \succ 0
\end{aligned}
\end{equation}
for all $\omega \in \Omega$. For this $\mathcal{H}_2$ problem, note that $\gamma$ is now a function of $\omega$ (which contrasts with the optimization problem in the $\mathcal{H}_\infty$ sense). 

\iffalse
If it is desired to minimize the $\mathcal{H}_\infty$ norm of a weighted sensitivity function, one can easily formulate an optimization problem to minimize $ \|W_q \mathcal{S}_q(k)\|_\infty$, i.e.,
 \begin{equation} \label{eq:min_weighted_norm}
\begin{aligned}
& \underset{ k \in \mathbb{R}}{\text{minimize}}
& & \gamma  \\
& \text{subject to:} & & \bigl[W_q \mathcal{S}_q(k)\bigr]^{\star}\bigl[W_q \mathcal{S}_q(k)\bigr] < \gamma
\end{aligned}
\end{equation}
Then, as was shown in (\ref{eq:min_loopshape})-(\ref{eq:loop_shape_LMI_inf}) for the loop-shaping problem, a corresponding LMI can be derived for the $\infty$-norm of the weighted sensitivity function. In a similar manner, the convex optimization problem can be derived for minimizing the 2-norm of the weighted sensitivity function (i.e., minimize $ \|W_q \mathcal{S}_q(k)\|_2^2$). 
\fi

\begin{remark}
\textit{Note that the choice of the initializing gains in $k_0$ may affect the stability of the closed-loop system (for either the optimization problems concerning the $\mathcal{H}_\infty$ or $\mathcal{H}_2$ norms). }
\end{remark}

The next section will discuss how to select these gains in order to ensure stability.

\subsection{Stability Analysis}
The model reference constraints developed in the previous section do not guarantee the stability of the closed-loop system. Setting a desired FRF to shape a closed-loop FRF is analogous to bounding the closed-loop FRF; it can be shown that unstable systems can still possess bounded FRF's. 

The initializing controller gains in $k_0$ play an important role in guaranteeing the stability of the closed-loop system. By using the Nyquist criterion, the stability of the closed-loop system can be ensured if certain conditions are met for these initializing gains. In this paper, it is assumed that the Nyquist contour has some small detours around the poles of the open-loop system on the imaginary axis.

\iffalse
Let us first recall the Nyquist stability criterion with the following Lemma:
\begin{lemma}
A closed-loop system with a plant $G(s)$ and a controller $C(s)$ in a unity-feedback structure is stable if and only if the Nyquist plot of $1+G(s)C(s)$
\begin{itemize}
\item makes $n_G + n_C$ counterclockwise encirclements of the origin, where $n_G$ and $n_C$ are the number of right-half-plane (RHP) poles of $G(s)$ and $C(s)$, respectively
\item does not pass through the origin
\end{itemize}
\end{lemma}
\fi


The following properties will be needed in order to properly analyze the stability conditions of the system:
\begin{definition}
Let \emph{wno}$\{ A(s)\}$ refer to the winding number around the origin, in the counterclockwise sense, of the image of $A(s)$  when $s$ traverses the Nyquist contour (with small detours around the poles of $A(s)$ on the imaginary axis). Then the following properties hold:
\begin{align}
\emph{wno}\bigl\{ A_1(s)A_2(s) \bigr\} &= \emph{wno}\bigl\{ A_1(s) \bigr\} + \emph{wno}\bigl\{ A_2(s) \bigr\}  \label{eq:wno_add}\\ 
\emph{wno}\bigl\{ A(s)\bigr\} &= -\emph{wno}\bigl\{ A^{\star}(s)\bigr\} \label{eq:wno_conj} \\ 
\emph{wno}\bigl\{ A(s)\bigr\} &= -\emph{wno}\bigl\{ A^{-1}(s)\bigr\} \label{eq:wno_inv}
\end{align}
\end{definition}
The open-loop FRF of the system $T(k)$ in Fig.~\ref{fig:damping_loop} is given as $$L(k) = G[H_1(k)+H_2(k)+H_3(k)].$$ Let $F(k) = H_1(k)+H_2(k)+H_3(k)$ such that $L(k) = GF(k)$; by the Nyquist stability criterion, the closed-loop system is stable if and only if $1+GF$ makes $n_{G}+n_F$ counter-clockwise encirclements of the origin (where $n_{G}$ and $n_F$ are, respectively, the number of right-half plane (RHP) poles of $G$ and $F$). The Nyquist plot of $1+GF$ must also not pass through the origin.

\begin{theorem} \label{Thm1}
Suppose that $k_i$, $k_u$, $k_{m_1}$, and $k_{m_2}$ are feasible solutions to the following constraint:
\begin{equation} \label{eq:theorem1_cond}
\begin{split}
z^{\star}(k)z_0+z_0^{\star}z(k) > 0 \qquad 
\forall \omega \in \Omega
\end{split}
\end{equation}
where 
\begin{align*}
z(k) &= 1+G[H_1(k)+H_2(k)+H_3(k)] \\
z_0 &= 1+G[H_1(k_0)+H_2(k_0)+H_3(k_0)]
\end{align*}
with $\{G,H_1,H_2,H_3\} \in \mathscr{S}$. Then the closed-loop system $T$ is stable if the parameters in the set $k_0$ are stabilizing initial gains.
\end{theorem}

\textit{Proof:}
The proof is based on the Nyquist stability criterion and the properties of the winding number. The winding number of $z^{\star}(k)z_0$ is given as follows:
\begin{equation} \label{eq:winding_proof}
\begin{aligned}
{\mbox{wno}} \{ z^{\star}(k)z_0\} &= {\mbox{wno}} \{ z^{\star}\} + {\mbox{wno}} \{ z_0\} \\
&= -{\mbox{wno}} \{ 1+GF(k)\} \\
&\phantom{=} + {\mbox{wno}} \{ 1+GF(k_0)\} \\
\end{aligned}
\end{equation}
where $F(k_0) = H_1(k_0) + H_2(k_0) + H_3(k_0)$. Note that $F(k)$ is strictly proper and $GF(k)$ is strictly proper; therefore, the winding number of $z^{\star}(k)z_0$ can be evaluated over $\Omega$ instead of the $D$-contour. Additionally, the constraint in (\ref{eq:theorem1_cond}) implies that $\Re\{ z^{\star}(k)z_0\} > 0$ (where $\Re\{ \cdot \}$ indicates the real part of the argument), which signifies that the Nyquist plot of $z^{\star}(k)z_0$ will not pass through or encircle the origin. Therefore, $\mbox{wno} \{ z^{\star}(k)z_0\} = 0$; from (\ref{eq:winding_proof}), the following condition can then be realized:
\begin{equation} \label{eq:winding_proof3}
\mbox{wno} \{ 1+GF(k)\} = {\mbox{wno}} \{ 1+GF(k_0)\}
\end{equation}
The condition in (\ref{eq:winding_proof3}) implies that if the initializing controllers $k_0$ are stabilizing (i.e., the open-loop system $GF(k_0)$ meets the Nyquist stability criterion), then the closed-loop system will be stable.
{\hfill \ensuremath{\blacksquare}}

For the given structure in Figure.~\ref{fig:damping_loop}, it remains to be shown how to select the initial stabilizing controllers in order to guarantee the stability of the closed-loop system. From the control structure of the power converter control system, it can be observed that if all the controller gains in Figure.~\ref{fig:damping_loop} are set to zero, then the system will be in open-loop. However, since $G \in \mathscr{S}$, then selecting $k_0 = 0$ will guarantee the stability of the closed-loop system. 


\subsection{Convex Optimization via Semi-Definite Programming}
All of the optimization problems considered in Section \ref{sec:controlperformance} are known as semi-infinite programming (SIP) problems since there are a finite number of optimization variables $k$ and an infinite number of constraints with respect to $\omega$. To solve any of these problems, the optimization algorithm can be converted to a semi-definite programming (SDP) problem. In this manner, a predefined frequency grid can be implemented in order to solve a finite number of constraints. In other words, for a finite number of frequency points $n$ selected in $\omega \in [0,\infty)$, then $n$ constraints must be satisfied. This frequency grid can be predefined in a variety of manners (see \cite{GKL10b}, \cite{SVBB11}, \cite{FR05}). 

\section{Case Study}
\label{sec:case}
The focus of this case study will be on the SATURN power converter, which incorporates the control structure shown in Figure.~\ref{fig:damping_loop} and uses the power converter with the architecture shown in Figure.~\ref{fig:circuit}. The SATURN converter is used in the Large Hardron Collider, in injector machines, in experimental areas to power warm magnets, and for DC or pulsed applications. In this power converter, a 18 kV$/$50 Hz transformer is used with a diode rectifier and a DC-Link filter for the AC/DC conversion. An IGBT bridge (4 quadrant operation) is then used for a DC/DC conversion, and the output of this bridge is then fed into the filter. For this application, two identical modules are assembled in series (which doubles the output voltage) where the equivalent switching frequency of this bridge is 5 kHz. A complete assembly of the SATURN power converter is shown in Fig.~\ref{fig:saturn_pc}. Table.~\ref{tab:specs} displays the values of the system characteristics of this power converter.


\begin{table}[]
\centering
\caption{System characteristics of SATURN power converter}
\label{tab:specs}
\begin{tabular}{c|c|c}
                                                                               & Value                      & Units \\ \hline
\begin{tabular}[c]{@{}c@{}}$U_0$\\ (Output Voltage)\end{tabular}               & $700$                      & V     \\ \hline
\begin{tabular}[c]{@{}c@{}}$I_0$\\ (Output Current)\end{tabular}               & $850$                      & A     \\ \hline
AC Input                                                                       & $18$                       & kV    \\ \hline
Input Frequency                                                                & $50$                       & Hz    \\ \hline
\begin{tabular}[c]{@{}c@{}}IGBT equivalent \\ switching frequency\end{tabular} & $5000$                     & Hz    \\ \hline
DSP sampling rate                                                              & $5000$                     & Hz    \\ \hline
Control Type                                                                   & RegFGC3 Type 10 / Ethernet \cite{CKS11} & $-$  
\end{tabular}
\end{table}

\begin{figure}
\centering
\includegraphics[width=\columnwidth]{../pics/Saturn_1}
\caption{SATURN power converter used for various applications at CERN.}
\label{fig:saturn_pc}
\end{figure} 

\iffalse
\begin{figure}
\centering
\includegraphics[width=\columnwidth, height=8cm]{../pics/load}
\caption{The SATURN load which is used to mimic the dynamics of the magnet.}
\label{fig:load}
\end{figure} 
\fi

\subsection{Frequency Response Measurement}
Since the proposed method is based on a data-driven methodology with frequency-domain data, the FRF of each subsystem within the power converter control system must be obtained. In other words, we must obtain the FRF of $G$, $H$, $P_1$, $P_2$, and the ADCs. The signals that are accessible for the measurements are shown in Fig.~\ref{fig:damping_loop}, which are the outputs of the sensors $P_1$ and $P_2$ and the input of the converter control system (which goes into an ADC). However, note that $G$ appears independently of $P_2$ in (\ref{eq:Tclp}) and (\ref{eq:Tcl}); since $P_1$ and $P_2$ are sensors with very high bandwidths relative to $G$ (approximately 10 kHz), then $G \approx GP_2$  at frequencies less than 1 kHz. The FRF of the ADCs in the control loop are not measured since the output of these ADCs are digital signals. As stated in section \ref{sec:system}, these ADCs can be considered as pure time delays; since these delays are known to be within specific ranges, a multi-model design can be formulated to incorporate this uncertainty in the design. 

The frequency response of the subsystems were obtained with a transfer function analyzer (Powertek GP102) which implements a sine-sweep method that recovers the gain and phase of a system at discrete frequency points. The appropriate scaling factors were taken into account for the measurements (due to the series connection of the SATURN modules) in order to coincide with the structure used in Fig.~\ref{fig:damping_loop}. The frequency responses of $GP_2$ and $GHP_1$ are shown in Fig.~\ref{fig:G} and Fig.~\ref{fig:GHP1}, respectively.

\begin{figure}
\centering
\includegraphics[width=\columnwidth]{../pics/G.eps}
\caption{Frequency response measurement of $GP_2$.}
\label{fig:G}
\end{figure} 

\begin{figure}
\centering
\includegraphics[width=\columnwidth]{../pics/GHP1.eps}
\caption{Frequency response measurement of $GHP_1$.}
\label{fig:GHP1}
\end{figure} 

\subsection{Controller Synthesis}
For this application, it was desired to shape $T^{\prime}(k)$ and $T(k)$ such that a bandwidth of 300 Hz and 500 Hz is attained, respectively (where both achieve a damping of $\zeta = 0.8$). Note that in both of these TF's, a pure delay appears in the numerator; therefore, the performance of the loop-shape algorithm can be improved by specifying a desired loop-shape $T_d(s) = T_d^*(s) e^{-s\tau}$ where $T_d^*(s)$ was selected as a standard second order process, i.e.,
\begin{equation}
T_d^*(s) = \frac{\omega_d^2}{s^2 + 2\zeta \omega_d s + \omega_d^2}
\end{equation}
where $\zeta$ is the damping factor and
\begin{equation*}
\omega_d = \frac{2 \pi f_d}{\sqrt{1-2\zeta^2 + \sqrt{2-4\zeta^2 + 4\zeta^4}}}
\end{equation*}
where $f_d$ is the desired closed-loop bandwidth. There is some uncertainty associated with the delay $\tau$; the range of this delay is $\tau \in [0,200]\mu s$ with a nominal value of $100 \mu s$. Therefore, for tracking purposes, $\tau = 100 \mu s$ in $T_d(s)$ can be selected as a viable performance criteria. Note that selecting $\tau$ to be another value within the uncertain range will not significantly impact the response. The critical values in the desired response are $f_d$ and $\zeta$. 

Although the delay $\tau$ from the power electronics was captured in the frequency response measurement, the delay $\tau_{a}$ from the ADCs in the control loop was not. However, the output of the TFA includes an ADC which is captured in the experiment, an ADC that is not present during normal operation. Therefore the difference of these delays should be considered in the controller synthesis. The value of this delay is uncertain and is known to be in the range of $\tau_{a} \in [0,30]\mu s$. Therefore, a multi-model design can be considered where the additional delay can be gridded in this range and incorporated into the closed-loop TF's. The grid was established in intervals of $5 \: \mu s$ (i.e., $\tau_{a_i} = [0,5,\ldots30] \mu s$, $i = 1,\ldots,7$).  

In the $\mathcal{H}_{\infty}$ sense, the optimization problem to consider for this case study is as follows:
 \begin{equation} \label{eq:case_study_opt}
\begin{aligned}
& \underset{ k \in \mathbb{R}}{\text{minimize}}
& & \gamma  \\
& \text{subject to:} & & \|T_i(k)-T_d\|_{\infty}< \gamma \\
& &  &\|T_i^{\prime}(k)-T_d^{\prime}\|_{\infty}< \gamma \\ 
& & & i = 1,\ldots,7
\end{aligned}
\end{equation}
where $T_i(k)$ and $T_i^{\prime}(k)$ are the closed-loop TF's that incorporate the additional $i$-th delay in $\tau_{a_i}$; $T_d$ is the desired closed-loop TF for shaping $T(k)$ (with a desired bandwidth of $f_d = 500$ Hz and damping $\zeta = 0.8$); $T_d^{\prime}$ is the desired closed-loop TF for shaping $T^{\prime}(k)$ (with a desired bandwidth of $f_d^{\prime} = 300$ Hz and damping $\zeta^{\prime} = \zeta$). In the $\mathcal{H}_2$ sense, the optimization problem to consider is as follows:
\begin{equation} \label{eq:case_study_opt_2}
\begin{aligned}
& \underset{ k \in \mathbb{R}}{\text{minimize}}
& & \int_0^{\infty} \gamma(\omega) d\omega  \\
& \text{subject to:} & & \|T_i(k)-T_d\|_2^2< \gamma(\omega) \\
& &  &\|T_i^{\prime}(k)-T_d^{\prime}\|_2^2< \gamma(\omega) \\ 
& & & i = 1,\ldots,7
\end{aligned}
\end{equation}
These optimization problems can be transformed to convex problems by implementing the methods outlined in Section \ref{sec:controlperformance}. 
\subsection{Experimental Results}
The constraints in the optimization problem in (\ref{eq:case_study_opt}) and (\ref{eq:case_study_opt_2}) were first converted to LMI constraints. Since the transfer function analyzer provides the gain and phase at discrete frequency points, the optimization problem then becomes an SDP problem. For solving the $\mathcal{H}_2$ problem in SDP form, the objective function in (\ref{eq:case_study_opt_2}) must be discretized where $\int \gamma(\omega) d\omega \rightarrow \sum_i \gamma_i$.

For comparative purposes, controllers were designed by considering the model of the process.  Since there was uncertainty associated with the delay $\tau$, a multi-model approach was implemented to ensure that the performance was attained for the uncertain values. Therefore, for the model-based design, the problem in (\ref{eq:case_study_opt}) and (\ref{eq:case_study_opt_2}) was solved by gridding in both $\tau$ and $\tau_{a}$.

The closed-loop frequency response of $|T^{\prime}|$ and $|T|$ are shown in Fig.~\ref{fig:d_loop} and Fig.~\ref{fig:v_loop} (respectively) for the solutions obtained by minimizing both the $\mathcal{H}_{\infty}$ and $\mathcal{H}_2$ norms of the process. From these figures, it can be observed that the model-based design produces the worst performance while the data-driven based design achieves the desired performance for both $T$ and $T^{\prime}$. The performance achieved by the data-driven method (in both the $\mathcal{H}_{\infty}$ and $\mathcal{H}_2$ minimization cases) are comparable. 

\begin{remark}
Note that the solutions obtained for the model-based design were nearly identical for both the $\mathcal{H}_2$ and $\mathcal{H}_\infty$ problems. Hence the single result shown for the model-based design in Fig.~\ref{fig:d_loop} and Fig.~\ref{fig:v_loop}. 
\end{remark}

Table.~\ref{tab:case_study} displays the optimal solutions for all criteria considered in this case study. It can be observed that the optimal solutions $\gamma^*$ obtained with the data-driven method are less than the solutions obtained with the model-based approach. This is due to the fact that the uncertainty in the delay $\tau$ for the model-based design was too conservative. This conservativeness was significantly reduced in the data-driven approach since the delay $\tau$ was captured in the FRF identification experiment. 

\begin{figure}
\centering
\includegraphics[width=\columnwidth]{../pics/d_loop_mag.eps}
\caption{Measured closed-loop response of $|T^{\prime}|$; data-driven method with $\mathcal{H}_{\infty}$ performance (red line); data-driven method with $\mathcal{H}_2$ performance (blue line); model-based approach with $\mathcal{H}_2 / \mathcal{H}_\infty$ performance (yellow line); -3 dB point representing 300 Hz bandwidth (dashed-black line).}
\label{fig:d_loop}
\end{figure} 

\begin{figure}
\centering
\includegraphics[width=\columnwidth]{../pics/v_loop_mag.eps}
\caption{Measured closed-loop response of $|T|$; data-driven method with $\mathcal{H}_{\infty}$ performance (red line); data-driven method with $\mathcal{H}_2$ performance (blue line); model-based approach with $\mathcal{H}_2 / \mathcal{H}_\infty$ performance (yellow line); -3 dB point representing $500$ Hz bandwidth (dashed-black line).}
\label{fig:v_loop}
\end{figure} 

\begin{table}[]
\centering
\caption{Comparison of optimal solutions between data-driven and model-based methodology}
\label{tab:case_study}
\begin{tabular}{c|c|c|c|c|c}
                                                                             & $k_i^*$ & $k_u^*$ & $k_{p_1}^*$ & $k_{p_2}^*$       & $\gamma^*$                                                     \\ \hline
\begin{tabular}[c]{@{}c@{}}$\mathcal{H}_\infty$\\ (data-driven)\end{tabular} & $1.29$  & $3.80$  & $0.42$      & $2 \cdot 10^{-6}$ & $0.057$                                                        \\ \hline
\begin{tabular}[c]{@{}c@{}}$\mathcal{H}_2$\\ (data-driven)\end{tabular}      & $1.39$  & $3.82$  & $0.60$      & $7 \cdot 10^{-7}$ & \begin{tabular}[c]{@{}c@{}}$0.108$\\ (peak value)\end{tabular} \\ \hline
\begin{tabular}[c]{@{}c@{}}$\mathcal{H}_\infty$\\ (model-based)\end{tabular} & $0.95$  & $1.70$  & $0.48$      & $3 \cdot 10^{-7}$ & $0.149$                                                        \\ \hline
\begin{tabular}[c]{@{}c@{}}$\mathcal{H}_2$\\ (model-based)\end{tabular}      & $0.95$  & $1.70$  & $0.48$      & $3 \cdot 10^{-7}$ & \begin{tabular}[c]{@{}c@{}}$0.191$\\ (peak value)\end{tabular}
\end{tabular}
\end{table}


\section{Conclusion}
\label{sec:conclusion}
A new data-driven method for computing a controller for the CERN power converter control system that attains $\mathcal{H}_2$ or $\mathcal{H}_{\infty}$ performance has been presented. A frequency-domain approach has been used in order to avoid the problem of unmodeled dynamics associated with parametric models. A non-convex model reference constraint was convexified by linearizing the non-convex function around a stabilizing operating point. This linearization process allowed the use of the Shur Complement Lemma to construct an LMI and solve a convex optimization problem. This method has been applied to a power converter control system which uses a specific controller structure and is used for experimental purposes at CERN. In the case study presented in this paper, it has been shown that the proposed data-driven method offers a systematic optimization-based approach that meets the challenging specifications required for the application. The experiments have confirmed that the data-driven approach significantly reduces the conservativeness associated with the modeling process. For future work, it will be desired to develop a method (in a data-driven sense) that will implement a search algorithm such that the global optimal solution to the $\mathcal{H}_{\infty}$ problem can be obtained.


\bibliography{linear}
\end{document}
